<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Contact Form Parser</title>
</head>
<body>
	<h1>Contact Form Parser</h1>
	<p>My Contact Form sanitizes strings for two reasons:</p>
	<ul>
		<li>Prevent malicious code to be entered and</li>
		<li>Dangerous Hyperlinks to be automatically generated by my email client.</li>
	</ul>
	<p>This parser takes the filtered message and recreates a save raw string.</p>
	
	<br>
	
	<h2>Input</h2>
	<textarea id="input" rows="10" cols="35"></textarea>
	
	<br>
	
	<button type="button" onclick="parse()">Convert</button>
	
	<h2>Output</h2>
	<div id="output"/>
	
	<script>
		function parse()
		{
			var inputString = document.getElementById("input").value;
			var parsedString = "";
			
			var stringLength = inputString.length;
			for( var i = 0; i < stringLength; ++i )
			{
				var charToParse = inputString.charAt(i);
				
				if( charToParse === '%')
				{
					var value1 = getValue(inputString.charAt(++i));
					var value2 = getValue(inputString.charAt(++i));
					
					var parsedValue = value1 * 16 + value2;
					var parsedCharacter = String.fromCharCode(parsedValue);
					
					if( parsedValue === 13 ) // Line Feed
						parsedString += "<br>";
					else
						parsedString += parsedCharacter;
				}
				else if ( charToParse === '\n')
				{
					parsedString += "<br>";
				}
				else
				{
					parsedString += charToParse;
				}
			}
			
			document.getElementById("output").innerHTML = parsedString;
		}
		
		function getValue(character)
		{
			var value = character.charCodeAt(0);
			
			if (value >= 65 && value <= 70)
				return value - 55;	// character is between A and F, value is between 10 and 15
			else if (value >= 48 && value <= 57)
				return value - 48;	// character is between 0 and 9, value is between 0 and 9
			else
				return -1;
		}
	</script>
</body>
</html>
